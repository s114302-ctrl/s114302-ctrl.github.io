<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¾®ç©åˆ†æ±ºé¬¥ï¼šé­”é¬¼é›£åº¦ç‰ˆ</title>
    <style>
        :root { --gold: #f1c40f; --green: #2ecc71; --red: #e74c3c; --blue: #3498db; }
        body { background: #121212; color: white; font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; margin: 0; }
        
        .screen { display: none; padding: 20px; min-height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
        #setup-screen { display: flex; }

        .math-card { 
            background: #000; border: 3px solid #555; padding: 35px; border-radius: 20px; 
            font-size: 1.7rem; margin: 20px; min-width: 350px; line-height: 2;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        #custom-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none;
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content {
            background: #2c3e50; padding: 40px; border-radius: 25px; border: 3px solid var(--gold);
            max-width: 450px; width: 90%; box-shadow: 0 0 50px rgba(241, 196, 15, 0.2);
        }
        .modal-result { font-size: 2.2rem; font-weight: bold; margin-bottom: 15px; }
        .modal-explain { background: #1a1a1a; padding: 20px; border-radius: 12px; text-align: left; font-size: 1.1rem; margin: 20px 0; color: #eee; line-height: 1.6; white-space: pre-line; }

        .timer-bg { width: 350px; height: 12px; background: #333; border-radius: 6px; margin: 20px; overflow: hidden; border: 1px solid #555; }
        #timer-bar { width: 100%; height: 100%; background: var(--gold); transition: width 0.1s linear; }

        button { padding: 15px 35px; font-size: 1.2rem; cursor: pointer; border-radius: 12px; border: none; font-weight: bold; margin: 8px; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-yes { background: var(--green); color: white; }
        .btn-no { background: var(--red); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        
        .scoreboard { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 25px; }
        .score-item { background: #222; padding: 10px 20px; border-radius: 8px; border-bottom: 4px solid var(--blue); font-weight: bold; }

        .yt-link { 
            margin-top: 50px; font-size: 1rem; color: #777; text-decoration: none; 
            padding: 12px 25px; border: 1px dashed #444; border-radius: 12px; transition: 0.3s; 
        }
        .yt-link:hover { color: #fff; background: rgba(255,0,0,0.15); border-color: #ff4444; }
        
        sub { font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen">
        <h1 style="color: var(--gold); font-size: 3rem; margin-bottom: 10px;">ğŸ’€ å¾®ç©åˆ†ï¼šé­”é¬¼æ±ºé¬¥</h1>
        <p style="font-size: 1.2rem; color: #bbb;">é€²éšé›£åº¦ï¼šåŒ…å«äºŒæ¬¡æ–¹ã€çµ•å°å€¼èˆ‡åˆ†å¼ç´„åˆ†</p>
        <div style="margin: 25px;">
            <label style="font-size: 1.3rem;">ğŸ‘¥ åƒæˆ°äººæ•¸ï¼š</label>
            <input type="number" id="total-players" value="2" min="2" max="10" style="padding: 8px; font-size: 1.2rem; width: 60px; background: #333; color: white; border: 1px solid var(--gold); border-radius: 5px;">
        </div>
        <div>
            <button class="btn-gold" onclick="initGame('limit')">ğŸ”¥ æ¥µé™æŒ‘æˆ°</button>
            <button class="btn-gold" onclick="initGame('cont')">â™¾ï¸ é€£çºŒæŒ‘æˆ°</button>
        </div>

        <a href="https://www.youtube.com/watch?v=vvpiudJxoXM" target="_blank" class="yt-link">
            ğŸ¤” è§€å¿µæ¨¡ç³Šå—ï¼Ÿè«‹å¾€å·¦è½‰ ğŸ‘ˆ è£œèª²å» â” ğŸ“º https://www.youtube.com/watch?v=vvpiudJxoXM
        </a>
    </div>

    <div id="game-screen" class="screen">
        <div id="player-tag" style="font-size: 1.6rem; background: var(--blue); color: white; padding: 8px 40px; border-radius: 30px; font-weight: bold; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);">ç©å®¶ 1</div>
        <div class="timer-bg"><div id="timer-bar"></div></div>
        <div class="math-card" id="ques-text"></div>
        <div class="btn-group">
            <button class="btn-yes" onclick="checkAnswer(true)">YES (å­˜åœ¨/é€£çºŒ)</button>
            <button class="btn-no" onclick="checkAnswer(false)">NO (ä¸å­˜åœ¨/ä¸é€£çºŒ)</button>
        </div>
        <div class="scoreboard" id="board"></div>
    </div>

    <div id="custom-modal">
        <div class="modal-content">
            <div id="res-title" class="modal-result"></div>
            <div id="res-explain" class="modal-explain"></div>
            <button class="btn-gold" id="next-btn" onclick="closeModal()">ä¸‹ä¸€ä½å—æ­»... ğŸƒ</button>
        </div>
    </div>

    <script>
        let s = { players: 2, scores: [], current: 0, mode: '', ans: null, timer: null, time: 5.0, detail: "" };

        function initGame(m) {
            s.players = parseInt(document.getElementById('total-players').value);
            s.mode = m;
            s.scores = new Array(s.players).fill(0);
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            updateBoard();
            nextQ();
        }

        function nextQ() {
            document.getElementById('player-tag').innerText = `ğŸ‘¤ ç©å®¶ ${s.current + 1} çš„å›åˆ`;
            const c = Math.floor(Math.random() * 5) - 2; // -2 to 2
            let isT = Math.random() > 0.5;
            let h = "";
            const type = Math.floor(Math.random() * 3);

            if (s.mode === 'limit') {
                if (type === 0) { // äºŒæ¬¡å‡½æ•¸éŠœæ¥
                    const a = Math.floor(Math.random() * 2) + 2;
                    const L = a * c * c;
                    const offset = isT ? 0 : (Math.random() > 0.5 ? 2 : -2);
                    const R = L + offset;
                    h = `f(x) = { ${a}xÂ², x < ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { x + ${R-c}, x > ${c} <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
                    s.detail = `ğŸ’¡ è§£æï¼š\nå·¦æ¥µé™: ${a}(${c})Â² = ${L}\nå³æ¥µé™: ${c} + ${R-c} = ${R}\n${L === R ? "âœ… å·¦å³ç›¸ç­‰ï¼Œæ¥µé™å­˜åœ¨ã€‚" : "âŒ å·¦å³ä¸ç›¸ç­‰ï¼Œæ¥µé™ä¸å­˜åœ¨ã€‚"}`;
                    s.ans = (L === R);
                } else if (type === 1) { // åˆ†å¼å¯å»é»
                    const L = c + 3;
                    h = `f(x) = (xÂ² + ${3-c}x - ${3*c}) / (x - ${c}) <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
                    s.detail = `ğŸ’¡ è§£æï¼š\nåˆ†å­å› å¼åˆ†è§£ç‚º (x-${c})(x+3)ã€‚\nç´„åˆ†å¾Œå‰© x+3ï¼Œä»£å…¥ x=${c} å¾—åˆ° ${L}ã€‚\nâœ… é€™æ˜¯å¯å»ä¸é€£çºŒé»ï¼Œæ¥µé™å­˜åœ¨ï¼`;
                    s.ans = true;
                } else { // çµ•å°å€¼è·³èº
                    const a = Math.floor(Math.random() * 3) + 2;
                    h = `f(x) = ${a} |x - ${c}| / (x - ${c}) <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
                    s.detail = `ğŸ’¡ è§£æï¼š\né€™æ˜¯è·³èºä¸é€£çºŒé»ã€‚\nå·¦æ¥µé™è¶¨è¿‘ -${a}ï¼Œå³æ¥µé™è¶¨è¿‘ ${a}ã€‚\nâŒ å·¦å³ä¸ç›¸ç­‰ï¼Œæ¥µé™ä¸å­˜åœ¨ã€‚`;
                    s.ans = false;
                }
            } else { // é€£çºŒæ¨¡å¼
                if (type === 0) { // äºŒæ¬¡é …
                    const L = c * c + 1;
                    const valC = isT ? L : L + 2;
                    h = `f(x) = { xÂ² + 1, x â‰  ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${valC}, x = ${c} <br> å•: f(x) åœ¨ x = ${c} é€£çºŒ?`;
                    s.detail = `ğŸ’¡ è§£æï¼š\næ¥µé™å€¼ L = ${c}Â² + 1 = ${L}\nå‡½æ•¸å€¼ f(${c}) = ${valC}\n${L === valC ? "âœ… L = f(c)ï¼Œé€£çºŒã€‚" : "âŒ L â‰  f(c)ï¼Œä¸é€£çºŒã€‚"}`;
                    s.ans = (L === valC);
                } else { // åˆ†å¼éŠœæ¥
                    const L = c - 2;
                    const valC = isT ? L : L + 1;
                    h = `f(x) = { (xÂ² - ${c+2}x + ${2*c}) / (x - ${c}), x â‰  ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${valC}, x = ${c} <br> å•: f(x) åœ¨ x = ${c} é€£çºŒ?`;
                    s.detail = `ğŸ’¡ è§£æï¼š\nåˆ†å­åˆ†è§£ç‚º (x-${c})(x-2)ï¼Œç´„åˆ†å¾Œæ¥µé™ç‚º ${c}-2 = ${L}ã€‚\nå‡½æ•¸å€¼ f(${c}) = ${valC}ã€‚\n${L === valC ? "âœ… ç›¸ç­‰ï¼Œé€£çºŒã€‚" : "âŒ ä¸ç›¸ç­‰ï¼Œä¸é€£çºŒã€‚"}`;
                    s.ans = (L === valC);
                }
            }

            document.getElementById('ques-text').innerHTML = h;
            startTimer();
        }

        function startTimer() {
            s.time = 5.0;
            clearInterval(s.timer);
            s.timer = setInterval(() => {
                s.time -= 0.1;
                document.getElementById('timer-bar').style.width = (s.time/5*100) + "%";
                if (s.time <= 0) { 
                    clearInterval(s.timer);
                    showModal(false, "ğŸ’€ æ™‚é–“çµ‚äº†ï¼\nåœ¨å¾®ç©åˆ†çš„ä¸–ç•Œè£¡ï¼Œé²ç–‘å°±æ˜¯æ­»äº¡ã€‚"); 
                }
            }, 100);
        }

        function checkAnswer(guess) {
            clearInterval(s.timer);
            const isCorrect = (guess === s.ans);
            if (isCorrect) s.scores[s.current]++;
            showModal(isCorrect, s.detail);
        }

        function showModal(correct, explain) {
            const m = document.getElementById('custom-modal');
            const t = document.getElementById('res-title');
            t.innerText = correct ? "âœ¨ æ“Šä¸­è¦å®³ï¼" : "ğŸ’¥ æ…˜é­åæ®ºï¼";
            t.style.color = correct ? "var(--green)" : "var(--red)";
            document.getElementById('res-explain').innerText = explain;
            m.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('custom-modal').style.display = 'none';
            if (s.scores[s.current] >= 5) {
                alert(`ğŸ‘‘ å¯©åˆ¤çµ‚çµï¼ç©å®¶ ${s.current + 1} æˆç‚ºäº†å¾®ç©åˆ†ä¹‹ç¥ï¼`);
                location.reload();
            } else {
                s.current = (s.current + 1) % s.players;
                updateBoard();
                nextQ();
            }
        }

        function updateBoard() {
            const b = document.getElementById('board');
            b.innerHTML = s.scores.map((sc, i) => `<div class="score-item">P${i+1}: ${sc} PTS</div>`).join('');
        }
    </script>
</body>
</html>
