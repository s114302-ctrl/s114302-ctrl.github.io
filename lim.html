<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å…¶å¯¦è¶…ç°¡å–®çš„å¾®ç©åˆ†æ±ºé¬¥</title>
    <style>
        :root { --gold: #f1c40f; --green: #2ecc71; --red: #e74c3c; }
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; }
        
        .screen { display: none; padding: 20px; min-height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
        #setup-screen { display: flex; }

        .math-card { background: #000; border: 3px solid #444; padding: 30px; border-radius: 15px; font-size: 1.6rem; margin: 20px; min-width: 300px; line-height: 1.8; }
        
        #custom-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none;
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content {
            background: #333; padding: 30px; border-radius: 20px; border: 3px solid var(--gold);
            max-width: 400px; width: 90%;
        }
        .modal-result { font-size: 2rem; font-weight: bold; margin-bottom: 10px; }
        .modal-explain { background: #111; padding: 15px; border-radius: 10px; text-align: left; font-size: 1rem; margin: 15px 0; color: #ccc; }

        .timer-bg { width: 300px; height: 10px; background: #444; border-radius: 5px; margin: 15px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--gold); transition: width 0.1s linear; }

        button { padding: 12px 30px; font-size: 1.1rem; cursor: pointer; border-radius: 8px; border: none; font-weight: bold; margin: 5px; }
        .btn-yes { background: var(--green); color: white; }
        .btn-no { background: var(--red); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        
        .scoreboard { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        .score-item { background: #444; padding: 5px 15px; border-radius: 5px; border-left: 4px solid var(--gold); }

        /* YT é€£çµæ¨£å¼å„ªåŒ– */
        .yt-link { 
            margin-top: 50px; 
            font-size: 1rem; 
            color: #aaa; 
            text-decoration: none; 
            padding: 10px 20px;
            border: 1px dashed #555;
            border-radius: 10px;
            transition: all 0.3s; 
        }
        .yt-link:hover { color: #fff; background: rgba(255,0,0,0.1); border-color: #ff0000; }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen">
        <h1 style="color: var(--gold);">ğŸ“ å¤šäººå¾®ç©åˆ†å¤§æˆ°</h1>
        <p>ä¸€äºº 5 ç§’ã€‚èª°å…ˆæ‹¿åˆ° 5 åˆ†å°±ç²å‹ï¼ğŸ†</p>
        <div style="margin: 20px;">
            <label>ğŸ‘¥ ç©å®¶äººæ•¸ï¼š</label>
            <input type="number" id="total-players" value="2" min="2" max="5" style="padding: 5px; font-size: 1rem;">
        </div>
        <div>
            <button class="btn-gold" onclick="initGame('limit')">ğŸš€ æ¥µé™æ¨¡å¼</button>
            <button class="btn-gold" onclick="initGame('cont')">â™¾ï¸ é€£çºŒæ¨¡å¼</button>
        </div>

        <a href="https://www.youtube.com/watch?v=vvpiudJxoXM" target="_blank" class="yt-link">
            ğŸ¤” ä¸çŸ¥é“æ¥µé™å’Œé€£çºŒæ˜¯ä»€éº¼å—ï¼Ÿè«‹å¾€å·¦è½‰ ğŸ‘ˆ è£œèª²å» â” ğŸ“º https://www.youtube.com/watch?v=vvpiudJxoXM
        </a>
    </div>

    <div id="game-screen" class="screen">
        <div id="player-tag" style="font-size: 1.5rem; background: var(--gold); color: black; padding: 5px 30px; border-radius: 20px; font-weight: bold;">ç©å®¶ 1</div>
        <div class="timer-bg"><div id="timer-bar"></div></div>
        <div class="math-card" id="ques-text"></div>
        <div class="btn-group">
            <button class="btn-yes" onclick="checkAnswer(true)">YES (å­˜åœ¨/é€£çºŒ)</button>
            <button class="btn-no" onclick="checkAnswer(false)">NO (ä¸å­˜åœ¨/ä¸é€£çºŒ)</button>
        </div>
        <div class="scoreboard" id="board"></div>
    </div>

    <div id="custom-modal">
        <div class="modal-content">
            <div id="res-title" class="modal-result"></div>
            <div id="res-explain" class="modal-explain"></div>
            <button class="btn-gold" id="next-btn" onclick="closeModal()">ä¸‹ä¸€ä½æº–å‚™ï¼ğŸƒ</button>
        </div>
    </div>

    <script>
        let s = { players: 2, scores: [], current: 0, mode: '', ans: null, timer: null, time: 5.0, detail: "" };

        function initGame(m) {
            s.players = parseInt(document.getElementById('total-players').value);
            s.mode = m;
            s.scores = new Array(s.players).fill(0);
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            updateBoard();
            nextQ();
        }

        function nextQ() {
            document.getElementById('player-tag').innerText = `ğŸ‘¤ ç©å®¶ ${s.current + 1} çš„å›åˆ`;
            const c = Math.floor(Math.random() * 4) + 1;
            const isT = Math.random() > 0.5;
            const a = Math.floor(Math.random() * 3) + 2;
            let h = "";

            if (s.mode === 'limit') {
                const b = Math.floor(Math.random() * 5);
                const d = isT ? a : a + 1;
                const e = isT ? b : b + 2;
                const L = a * c + b;
                const R = d * c + e;
                h = `f(x) = { ${a}x+${b}, x<${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${d}x+${e}, x>${c} <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
                s.detail = `ğŸ’¡ è§£æï¼š\nå·¦æ¥µé™è¶¨è¿‘ ${L}ï¼Œå³æ¥µé™è¶¨è¿‘ ${R}ã€‚\n${L === R ? "âœ… å…©è€…ç›¸ç­‰ï¼Œæ‰€ä»¥æ¥µé™å­˜åœ¨ã€‚" : "âŒ å…©è€…ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ã€‚"}`;
            } else {
                const valC = isT ? a*c : a*c + 2;
                const lim = a*c;
                h = `f(x) = { ${a}x, xâ‰ ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${valC}, x=${c} <br> å•: f(x) åœ¨ x=${c} æ˜¯å¦é€£çºŒ?`;
                s.detail = `ğŸ’¡ è§£æï¼š\næ¥µé™å€¼(ç©ºå¿ƒé»)ç‚º ${lim}ï¼Œå‡½æ•¸å€¼ f(${c}) ç‚º ${valC}ã€‚\n${lim === valC ? "âœ… å…©è€…ç›¸ç­‰ï¼Œæ‰€ä»¥é€£çºŒã€‚" : "âŒ å…©è€…ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ä¸é€£çºŒã€‚"}`;
            }

            document.getElementById('ques-text').innerHTML = h;
            s.ans = isT;
            startTimer();
        }

        function startTimer() {
            s.time = 5.0;
            clearInterval(s.timer);
            s.timer = setInterval(() => {
                s.time -= 0.1;
                document.getElementById('timer-bar').style.width = (s.time/5*100) + "%";
                if (s.time <= 0) { 
                    clearInterval(s.timer);
                    showModal(false, "â° æ™‚é–“åˆ°äº†ï¼åæ‡‰å¤ªæ…¢å›‰ï¼Œé€™é¡Œæ²’æ‹¿åˆ°åˆ†æ•¸ã€‚"); 
                }
            }, 100);
        }

        function checkAnswer(guess) {
            clearInterval(s.timer);
            const isCorrect = (guess === s.ans);
            if (isCorrect) s.scores[s.current]++;
            showModal(isCorrect, s.detail);
        }

        function showModal(correct, explain) {
            const m = document.getElementById('custom-modal');
            const t = document.getElementById('res-title');
            t.innerText = correct ? "ğŸ‰ ç­”å°äº†ï¼" : "ğŸ’¥ ç­”éŒ¯äº†ï¼";
            t.style.color = correct ? "var(--green)" : "var(--red)";
            document.getElementById('res-explain').innerText = explain;
            m.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('custom-modal').style.display = 'none';
            if (s.scores[s.current] >= 5) {
                alert(`ğŸŠ æœ€çµ‚å¤§è´å®¶ï¼šç©å®¶ ${s.current + 1}ï¼æ­å–œç²å¾—å¾®ç©åˆ†å¤§å¸«ç¨±è™Ÿï¼`);
                location.reload();
            } else {
                s.current = (s.current + 1) % s.players;
                updateBoard();
                nextQ();
            }
        }

        function updateBoard() {
            const b = document.getElementById('board');
            b.innerHTML = s.scores.map((sc, i) => `<div class="score-item">P${i+1}: ${sc} åˆ†</div>`).join('');
        }
    </script>
</body>
</html>
