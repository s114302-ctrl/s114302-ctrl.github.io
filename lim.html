<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¾®ç©åˆ†æ±ºé¬¥ï¼šå…¨åŠŸèƒ½é€²éšç‰ˆ</title>
    <style>
        :root { --gold: #f1c40f; --green: #2ecc71; --red: #e74c3c; --bg: #1a1a1a; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; }
        
        .screen { display: none; padding: 20px; min-height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
        #setup-screen { display: flex; }

        .config-group { background: #333; padding: 25px; border-radius: 15px; border: 1px solid #555; margin-bottom: 20px; }
        select, input { padding: 8px; font-size: 1rem; border-radius: 5px; border: none; margin: 0 10px; }

        .math-card { background: #000; border: 3px solid #444; padding: 30px; border-radius: 15px; font-size: 1.6rem; margin: 20px; min-width: 350px; line-height: 1.8; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        #custom-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none;
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content {
            background: #2c3e50; padding: 30px; border-radius: 20px; border: 3px solid var(--gold);
            max-width: 450px; width: 90%;
        }
        .modal-explain { background: #1a1a1a; padding: 15px; border-radius: 10px; text-align: left; font-size: 1rem; margin: 15px 0; color: #eee; white-space: pre-line; border-left: 5px solid var(--gold); }

        .timer-bg { width: 300px; height: 12px; background: #444; border-radius: 6px; margin: 15px; overflow: hidden; border: 1px solid #666; }
        #timer-bar { width: 100%; height: 100%; background: var(--gold); transition: width 0.1s linear; }

        button { padding: 12px 30px; font-size: 1.1rem; cursor: pointer; border-radius: 8px; border: none; font-weight: bold; margin: 5px; transition: 0.2s; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        .btn-yes { background: var(--green); color: white; }
        .btn-no { background: var(--red); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        
        .scoreboard { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        .score-item { background: #444; padding: 8px 18px; border-radius: 8px; border-bottom: 3px solid var(--gold); font-weight: bold; }

        .yt-link { margin-top: 50px; font-size: 0.95rem; color: #aaa; text-decoration: none; padding: 12px; border: 1px dashed #555; border-radius: 10px; transition: 0.3s; }
        .yt-link:hover { color: #fff; border-color: #ff0000; background: rgba(255,0,0,0.05); }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen">
        <h1 style="color: var(--gold); font-size: 2.5rem;">ğŸ“ å¤šäººå¾®ç©åˆ†å¤§æ±ºé¬¥</h1>
        <div class="config-group">
            <label>ğŸ‘¥ äººæ•¸ï¼š</label>
            <input type="number" id="total-players" value="2" min="1" max="10">
            <label>ğŸ”¥ é›£åº¦ï¼š</label>
            <select id="difficulty">
                <option value="easy">Easy (åŸºç¤ä¸€æ¬¡å¼)</option>
                <option value="hard">Hard (äºŒæ¬¡/åˆ†å¼/çµ•å°å€¼)</option>
            </select>
        </div>
        <div style="margin-bottom: 20px;">
            <button class="btn-gold" onclick="initGame('limit')">ğŸš€ æ¥µé™æ¨¡å¼</button>
            <button class="btn-gold" onclick="initGame('cont')">â™¾ï¸ é€£çºŒæ¨¡å¼</button>
        </div>
        <a href="https://www.youtube.com/watch?v=vvpiudJxoXM" target="_blank" class="yt-link">
            ğŸ¤” ä¸çŸ¥é“æ¥µé™å’Œé€£çºŒæ˜¯ä»€éº¼ï¼Ÿè«‹å·¦è½‰ ğŸ‘ˆ è£œèª²å» â” ğŸ“º https://www.youtube.com/watch?v=vvpiudJxoXM
        </a>
    </div>

    <div id="game-screen" class="screen">
        <div id="player-tag" style="font-size: 1.4rem; background: var(--gold); color: black; padding: 6px 35px; border-radius: 25px; font-weight: bold;">ç©å®¶ 1</div>
        <div class="timer-bg"><div id="timer-bar"></div></div>
        <div class="math-card" id="ques-text"></div>
        <div class="btn-group">
            <button class="btn-yes" onclick="checkAnswer(true)">YES (å­˜åœ¨/é€£çºŒ)</button>
            <button class="btn-no" onclick="checkAnswer(false)">NO (ä¸å­˜åœ¨/ä¸é€£çºŒ)</button>
        </div>
        <div class="scoreboard" id="board"></div>
    </div>

    <div id="custom-modal">
        <div class="modal-content">
            <div id="res-title" style="font-size: 2.2rem; font-weight: bold; margin-bottom: 15px;"></div>
            <div id="res-explain" class="modal-explain"></div>
            <button class="btn-gold" onclick="closeModal()">ä¸‹ä¸€ä½æ¥æ‰‹ï¼ğŸƒ</button>
        </div>
    </div>

    <script>
        let s = { players: 2, scores: [], current: 0, mode: '', diff: 'easy', ans: null, timer: null, time: 5.0, detail: "" };

        function initGame(m) {
            s.players = parseInt(document.getElementById('total-players').value);
            s.diff = document.getElementById('difficulty').value;
            s.mode = m;
            s.scores = new Array(s.players).fill(0);
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            updateBoard();
            nextQ();
        }

        function generateEasyQ() {
            const c = Math.floor(Math.random() * 5) + 1;
            const isT = Math.random() > 0.5;
            const a = Math.floor(Math.random() * 3) + 2;
            const b = Math.floor(Math.random() * 5);
            if (s.mode === 'limit') {
                const d = isT ? a : a + 1;
                const e = isT ? b : b + 2;
                const L = a * c + b, R = d * c + e;
                s.ans = isT;
                s.detail = `å·¦æ¥µé™è¶¨è¿‘ ${L}ï¼Œå³æ¥µé™è¶¨è¿‘ ${R}ã€‚\n${L === R ? "âœ… ç›¸ç­‰ï¼Œå­˜åœ¨ã€‚" : "âŒ ä¸ç›¸ç­‰ï¼Œä¸å­˜åœ¨ã€‚"}`;
                return `f(x) = { ${a}x+${b}, x<${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${d}x+${e}, x>${c} <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
            } else {
                const valC = isT ? a * c : a * c + 2;
                s.ans = isT;
                s.detail = `æ¥µé™å€¼ç‚º ${a * c}ï¼Œå‡½æ•¸å€¼ f(${c}) ç‚º ${valC}ã€‚\n${(a*c) === valC ? "âœ… ç›¸ç­‰ï¼Œé€£çºŒã€‚" : "âŒ ä¸ç›¸ç­‰ï¼Œä¸é€£çºŒã€‚"}`;
                return `f(x) = { ${a}x, xâ‰ ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${valC}, x=${c} <br> å•: f(x) åœ¨ x=${c} æ˜¯å¦é€£çºŒ?`;
            }
        }

        function generateHardQ() {
            const c = Math.floor(Math.random() * 5) - 2; // -2 ~ 2
            const isT = Math.random() > 0.5;
            const type = Math.floor(Math.random() * 3);

            if (s.mode === 'limit') {
                if (type === 0) { // äºŒæ¬¡é …
                    const a = Math.floor(Math.random() * 2) + 1;
                    const L = a * c * c;
                    const R = isT ? L : L + 2;
                    s.ans = isT;
                    s.detail = `å·¦æ¥µé™: ${a}(${c})Â² = ${L}\nå³æ¥µé™: ${c} + ${R-c} = ${R}\n${L===R?"âœ… å­˜åœ¨":"âŒ ä¸å­˜åœ¨"}`;
                    return `f(x) = { ${a === 1 ? "" : a}xÂ², x < ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { x + ${R-c}, x > ${c} <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
                } else { // åˆ†å¼å‹ (å¯å»ä¸é€£çºŒ)
                    s.ans = true;
                    s.detail = `åˆ†å­å¯åˆ†è§£ç‚º (x-${c})(x+${c})ï¼Œç´„åˆ†å¾Œæ¥µé™ç‚º ${c}+${c}=${c*2}ã€‚\nâœ… æ¥µé™æ°¸é å­˜åœ¨ã€‚`;
                    return `f(x) = (xÂ² - ${c*c}) / (x - ${c}) <br> å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
                }
            } else { // é€£çºŒæ¨¡å¼
                const L = c + 2;
                const valC = isT ? L : L + 1;
                s.ans = isT;
                s.detail = `æ¥µé™å€¼(ç´„åˆ†å¾Œ)ç‚º ${c}+2 = ${L}\nå‡½æ•¸å€¼ f(${c}) = ${valC}\n${L === valC ? "âœ… é€£çºŒ" : "âŒ ä¸é€£çºŒ"}`;
                return `f(x) = { (xÂ² + ${2-c}x - ${2*c}) / (x - ${c}), x â‰  ${c} <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${valC}, x = ${c} <br> å•: f(x) åœ¨ x = ${c} æ˜¯å¦é€£çºŒ?`;
            }
        }

        function nextQ() {
            document.getElementById('player-tag').innerText = `ğŸ‘¤ ç©å®¶ ${s.current + 1} çš„å›åˆ (${s.diff.toUpperCase()})`;
            const h = (s.diff === 'easy') ? generateEasyQ() : generateHardQ();
            document.getElementById('ques-text').innerHTML = h;
            startTimer();
        }

        function startTimer() {
            s.time = 5.0; clearInterval(s.timer);
            s.timer = setInterval(() => {
                s.time -= 0.1;
                document.getElementById('timer-bar').style.width = (s.time/5*100) + "%";
                if (s.time <= 0) { clearInterval(s.timer); showModal(false, "â° æ™‚é–“åˆ°ï¼ä¾†ä¸åŠæ€è€ƒå°±å¤±åˆ†å›‰ã€‚"); }
            }, 100);
        }

        function checkAnswer(guess) {
            clearInterval(s.timer);
            const correct = (guess === s.ans);
            if (correct) s.scores[s.current]++;
            showModal(correct, s.detail);
        }

        function showModal(correct, explain) {
            const m = document.getElementById('custom-modal');
            const t = document.getElementById('res-title');
            t.innerText = correct ? "ğŸ‰ ç­”å°äº†ï¼" : "ğŸ’¥ ç­”éŒ¯äº†ï¼";
            t.style.color = correct ? "var(--green)" : "var(--red)";
            document.getElementById('res-explain').innerText = "ğŸ’¡ è§£æï¼š\n" + explain;
            m.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('custom-modal').style.display = 'none';
            if (s.scores[s.current] >= 5) {
                alert(`ğŸŠ æ­å–œç©å®¶ ${s.current + 1} ç²å¾—æœ€å¾Œå‹åˆ©ï¼`);
                location.reload();
            } else {
                s.current = (s.current + 1) % s.players;
                updateBoard();
                nextQ();
            }
        }

        function updateBoard() {
            const b = document.getElementById('board');
            b.innerHTML = s.scores.map((sc, i) => `<div class="score-item">P${i+1}: ${sc}</div>`).join('');
        }
    </script>
</body>
</html>
