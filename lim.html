<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¾®ç©åˆ†æ±ºé¬¥ï¼šå¤šäººè¼ªæŠ½ç‰ˆ</title>
    <style>
        :root { --main-gold: #f1c40f; --bg-dark: #1a1a1a; }
        body { background: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; }
        
        .screen { display: none; padding: 20px; min-height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
        #setup-screen { display: flex; }

        /* è¨­å®šæ¡† */
        .config-box { background: #333; padding: 30px; border-radius: 20px; border: 2px solid var(--main-gold); }
        input[type="number"] { padding: 10px; font-size: 1.2rem; width: 60px; border-radius: 5px; border: none; text-align: center; }

        /* éŠæˆ²ç•«é¢å…ƒä»¶ */
        .player-tag { font-size: 2rem; font-weight: bold; padding: 10px 50px; border-radius: 50px; background: var(--main-gold); color: #000; margin-bottom: 20px; }
        
        .timer-container { width: 300px; height: 15px; background: #444; border-radius: 10px; margin: 20px auto; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: #e74c3c; transition: width 0.1s linear; }

        .math-card { 
            background: #000; border: 2px solid #555; padding: 40px; border-radius: 15px; 
            font-size: 1.8rem; line-height: 1.6; margin: 20px; min-width: 350px;
        }

        button { padding: 15px 35px; font-size: 1.2rem; cursor: pointer; border-radius: 10px; border: none; font-weight: bold; transition: 0.2s; }
        button:hover { transform: scale(1.05); }
        .btn-yes { background: #27ae60; color: white; margin-right: 10px; }
        .btn-no { background: #c0392b; color: white; }
        .btn-start { background: var(--main-gold); margin-top: 20px; }

        /* è¨ˆåˆ†æ¿ */
        .scoreboard { margin-top: 40px; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .score-item { background: #444; padding: 10px 20px; border-radius: 10px; border-bottom: 3px solid var(--main-gold); }

        /* æº–å‚™é®ç½© */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen">
        <div class="config-box">
            <h1 style="color: var(--main-gold);">ğŸ“ å¤šäººå¾®ç©åˆ†å¤§æˆ°</h1>
            <div style="margin: 20px 0;">
                <label>ç¸½ç©å®¶äººæ•¸ï¼š</label>
                <input type="number" id="total-players" value="2" min="2" max="10">
            </div>
            <p>æ¨¡å¼é¸æ“‡ï¼š</p>
            <button class="btn-start" onclick="initMultiGame('limit')">æ¥µé™æ˜¯å¦å­˜åœ¨</button>
            <button class="btn-start" onclick="initMultiGame('cont')">å‡½æ•¸æ˜¯å¦é€£çºŒ</button>
        </div>
    </div>

    <div id="ready-overlay" class="overlay">
        <h1 id="next-player-name" style="font-size: 3rem; color: var(--main-gold);">ç©å®¶ X</h1>
        <p style="font-size: 1.5rem;">è«‹æ¥éæ»‘é¼ ...</p>
        <button class="btn-start" onclick="startActualTurn()">æˆ‘æº–å‚™å¥½äº†ï¼Œé–‹å§‹ 5 ç§’å€’æ•¸ï¼</button>
    </div>

    <div id="game-screen" class="screen">
        <div id="current-player-tag" class="player-tag">ç©å®¶ 1</div>
        
        <div class="timer-container">
            <div id="timer-bar"></div>
        </div>

        <div class="math-card" id="math-ques">é¡Œç›®è¼‰å…¥ä¸­...</div>

        <div class="btn-group">
            <button class="btn-yes" onclick="submitAnswer(true)">YES</button>
            <button class="btn-no" onclick="submitAnswer(false)">NO</button>
        </div>

        <div class="scoreboard" id="board">
            </div>
    </div>

    <script>
        let state = {
            numPlayers: 2,
            scores: [],
            currentPlayerIdx: 0, // å¾ 0 é–‹å§‹ç®—
            mode: '',
            currentAns: null,
            timer: null,
            timeLeft: 5.0
        };

        function initMultiGame(mode) {
            state.numPlayers = parseInt(document.getElementById('total-players').value);
            state.mode = mode;
            state.scores = new Array(state.numPlayers).fill(0);
            
            // åˆå§‹åŒ–è¨ˆåˆ†æ¿ UI
            const board = document.getElementById('board');
            board.innerHTML = '';
            for(let i=0; i<state.numPlayers; i++) {
                board.innerHTML += `<div class="score-item" id="sb-${i}">ç©å®¶ ${i+1}: 0 åˆ†</div>`;
            }

            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            showReadyOverlay();
        }

        function showReadyOverlay() {
            const overlay = document.getElementById('ready-overlay');
            document.getElementById('next-player-name').innerText = `è¼ªåˆ° ç©å®¶ ${state.currentPlayerIdx + 1}`;
            overlay.style.display = 'flex';
        }

        function startActualTurn() {
            document.getElementById('ready-overlay').style.display = 'none';
            document.getElementById('current-player-tag').innerText = `ç©å®¶ ${state.currentPlayerIdx + 1}`;
            
            generateQuestion();
            startTimer();
        }

        function generateQuestion() {
            const c = Math.floor(Math.random() * 3) + 1;
            const isTrue = Math.random() > 0.5;
            const a = Math.floor(Math.random() * 3) + 2;
            let qHtml = "";

            if (state.mode === 'limit') {
                const b = Math.floor(Math.random() * 5);
                const d = isTrue ? a : a + 1;
                const e = isTrue ? b : b + 2;
                qHtml = `f(x) = { ${a}x + ${b}, x < ${c}<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${d}x + ${e}, x > ${c}<br>å•: lim<sub>xâ†’${c}</sub> f(x) å­˜åœ¨?`;
            } else {
                const valAtC = isTrue ? (a * c) : (a * c + 2);
                qHtml = `f(x) = { ${a}x, x â‰  ${c}<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { ${valAtC}, x = ${c}<br>å•: f(x) åœ¨ x = ${c} æ˜¯å¦é€£çºŒ?`;
            }

            document.getElementById('math-ques').innerHTML = qHtml;
            state.currentAns = isTrue;
        }

        function startTimer() {
            state.timeLeft = 5.0;
            const bar = document.getElementById('timer-bar');
            clearInterval(state.timer);
            
            state.timer = setInterval(() => {
                state.timeLeft -= 0.1;
                bar.style.width = (state.timeLeft / 5 * 100) + "%";
                
                if (state.timeLeft <= 0) {
                    clearInterval(state.timer);
                    alert("æ™‚é–“åˆ°ï¼å¤±åˆ†ï¼");
                    nextTurn();
                }
            }, 100);
        }

        function submitAnswer(guess) {
            clearInterval(state.timer);
            if (guess === state.currentAns) {
                state.scores[state.currentPlayerIdx]++;
                document.getElementById(`sb-${state.currentPlayerIdx}`).innerText = `ç©å®¶ ${state.currentPlayerIdx + 1}: ${state.scores[state.currentPlayerIdx]} åˆ†`;
                alert("ç­”å°äº†ï¼åŠ ä¸€åˆ†ï¼");
            } else {
                alert("ç­”éŒ¯äº†...");
            }

            // å‹åˆ©æ¢ä»¶ï¼šæœ‰äººé”åˆ° 5 åˆ†
            if (state.scores[state.currentPlayerIdx] >= 5) {
                alert(`ğŸ† æœ€çµ‚å‹åˆ©è€…æ˜¯ï¼šç©å®¶ ${state.currentPlayerIdx + 1}ï¼ï¼`);
                location.reload();
            } else {
                nextTurn();
            }
        }

        function nextTurn() {
            state.currentPlayerIdx = (state.currentPlayerIdx + 1) % state.numPlayers;
            showReadyOverlay();
        }
    </script>
</body>
</html>
